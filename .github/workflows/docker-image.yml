name: Deploy with Docker Compose

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Log in to Docker Hub
        run: echo "${{ secrets.DOCKERHUB_PASSWORD }}" | docker login -u "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin

      - name: Pull and Run Docker Compose
        run: |
          docker compose pull
          docker compose up -d --build --build-arg DATABASE_URL=${{ secrets.DATABASE_URL }} \
            --build-arg NEXTAUTH_SECRET=${{ secrets.NEXTAUTH_SECRET }} \
            --build-arg NEXTAUTH_URL=${{ secrets.NEXTAUTH_URL }} \
            --build-arg GOOGLE_CLIENT_ID=${{ secrets.GOOGLE_CLIENT_ID }} \
            --build-arg GOOGLE_CLIENT_SECRET=${{ secrets.GOOGLE_CLIENT_SECRET }}
      # - name: Build the docker image
      #   id: build-docker-image
      #   run: | 
      #       docker build \
      #       --build-arg DATABASE_URL=${{ secrets.DATABASE_URL }} \
      #       --build-arg NEXTAUTH_SECRET=${{ secrets.NEXTAUTH_SECRET }} \
      #       --build-arg NEXTAUTH_URL=${{ secrets.NEXTAUTH_URL }} \
      #       --build-arg GOOGLE_CLIENT_ID=${{ secrets.GOOGLE_CLIENT_ID }} \
      #       --build-arg GOOGLE_CLIENT_SECRET=${{ secrets.GOOGLE_CLIENT_SECRET }} \
      #       -t mcuron/client-connect:latest .
      - name: Push the docker image
        id: push-docker-image
        run: | 
            docker push mcuron/client-connect:latest